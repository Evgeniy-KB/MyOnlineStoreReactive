# Web-приложение «Витрина интернет-магазина» и RESTful-сервис платежей с использованием Spring Boot, REST и Redis на реактивном стеке технологий (MyOnlineStoreReactive)

## Содержание
- Описание приложения
    - Используемые технологии
    - Функционал приложения
    - Функционал сервиса оплаты
- Работа с приложением
    - Сборка и подготовка приложения
    - Запуск тестов
    - Запуск приложения

### Описание приложения

#### Используемые технологии
- Java 21
- Maven
- Spring Boot Framework
- Spring Data R2DBC
- Spring Data Redis
- Spring WebFlux
- Thymeleaf
- H2
- OpenAPI
- REST
- Redis
- Docker

#### Функционал приложения
- Веб-приложение представляет собой витрину товаров, которые пользователь может положить в корзину и купить.
  Приложение состоит из шести основных частей (модулей):
    + страница витрины товаров, доступных для просмотра и покупки, на которой представлены:
        * список товаров, доступных для заказа (название, картинка, описание товара, цена), берётся из кэша товаров в Redis, а если в кэше данных нет, то загружается в него из БД;
        * строка поиска с фильтрацией по названию (по вхождению слова в название/описание товара без учета регистра текста);
        * пагинация (по 10, 20, 50, 100 товаров на странице);
        * сортировка товаров по цене/алфавиту;
        * кнопка открытие формы для добавления нового товара;
        * данные в списке товаров берутся из кэша товаров в Redis, а если в кэше данных нет, то загружаются в него из БД
    + страница товара, на которую происходит переход при нажатии на название товара, и на которой представлены:
        * название товара;
        * картинка товара;
        * описание товара;
        * цена товара;
        * возможность установить желаемое количество в корзине для покупки (при помощи кнопок +/- или текстового поля для ввода);
        * возможность положить товар в корзину;
        * данные о товаре берутся из кэша товаров в Redis, а если в кэше данных нет, то загружаются в него из БД
    + страница корзины покупателя со списком всех добавленных товаров для покупки, на которой представлены:
        * название товара, цена, количество товара;
        * возможность изменить количество товара в корзине;
        * возможность удалить товар из корзины;
        * общая цена всей корзины;
        * кнопка оформления заказа (при нажатии осуществляется REST-запрос в сервис платежей, и при успешной оплате покупки происходит эмуляция оформления заказа и переход на страницу оформленного заказа);
        * данные в списке товаров берутся из кэша товаров в Redis, а если в кэше данных нет, то загружаются в него из БД.
    + страница оформленного заказа содержит список купленных товаров, на которой представлены:
        * название, картинка, цена, количество, общая цена;
        * общая цена всего заказа;
    + страница заказов со списком всех оформленных заказов, на которой представлены:
        * оформленный заказ, сумма заказа;
        * общая сумма всех заказов;
        * при нажатии на заказ появляется веб-страница оформленного заказа
    + страница добавления нового товара с заполнением на форме:
        * названия товара;
        * картинки товара;
        * описания товара;
        * цены товара;
          В правом верхнем углу любой веб-страницы есть кнопки перехода в корзину и просмотра всех заказов.

#### Функционал сервиса оплаты
- Сервис платежей представляет собой RESTful-приложение для осуществления оплаты товаров, которые пользователь может положить в корзину и купить.  
  Сервис содержит два реактивных HTTP-эндпоинта:
    - http://localhost:8081/api/balance (получение баланса на счёте);
    - http://localhost:8081/api/pay?price=50 (осуществление платежа - при условии достаточного количества средств считается, что оплата заказа выполнена);
  
  Если сервис платежей недоступен или баланс меньше суммы цены товаров в корзине или недостаточно средств для оплаты, то кнопка оформления заказа недоступна. В таких случаях показываются соответствующие сообщения.

  На основе разработанной OpenAPI спецификации сгенерированы директорию созданной копии проекта командами:
  - "mvnw clean generate-sources -P openapi-client" (клиент основного сервиса для осуществления запросов в сервис платежей);
  - "mvnw clean generate-sources -P openapi-server" (REST-контроллер сервиса платежей для приёма запросов от основного приложения).


### Работа с приложением

#### Сборка и подготовка приложения
- Необходимо установить и настроить Redis. Для запуска Redis в Docker-контейнере необходимо установить Docker Desktop и выполнить в командной строке:
  - "docker pull redis" (загрузить последний образ Redis);
  - "docker run --name myredis -d -p 6379:6379 redis" (запустить контейнер Redis);
  - "docker exec -it myredis redis-cli" (проверить успешную работу сервера Redis);
- Необходимо выполнить локальное копирование проекта из репозитория (клонировать или загрузить и распаковать его);
- Выполнить переход в командной строке в директорию созданной копии проекта и выполнить команду сборки модуля витрины интернет-магазина: "mvnw clean compile -am -pl web-app";
- Выполнить переход в командной строке в директорию созданной копии проекта и выполнить команду сборки Restful-сервиса оплаты: "mvnw clean compile -am -pl restful-payment";

#### Запуск тестов
Запуск тестов может быть выполнен одним из следующих способов:
- выполнить переход в командной строке в директорию созданной копии проекта и выполнить команду запуска тестов "mvnw clean test";
- из среды разработки (IntelliJ Idea) проекта на модуле (web-app, restful-payment) вызвать контекстное меню и выбрать команду "Run 'All Tests'";

#### Запуск приложения
Запуск приложения витрины интернет-магазина может быть выполнен одним из следующих способов:
- при выполненном запуске контейнера Redis из среды разработки (IntelliJ Idea):
  - в модуле проекта "web-app" на корневом файле запуска WebApplication.java вызвать контекстное меню и выбрать команду "Run 'WebApplication.main()'";
  - в модуле проекта "restful-payment" на корневом файле запуска RestfulPaymentApplication.java вызвать контекстное меню и выбрать команду "Run 'RestfulPaymentApplication.main()'";

- при выполненном запуске контейнера Redis в командных строках выполнить:
  - из директории проекта с использованием плагина для maven выполнить команду "mvnw -am -pl web-app spring-boot:run";
  - из директории проекта с использованием плагина для maven выполнить команду "mvnw -am -pl restful-payment spring-boot:run";

- с использованием Docker Compose из директории проекта в командной строке выполнить:
  - "docker-compose build" (сборка образов на основе инструкций, указанных в docker-compose.yml);
  - "docker-compose up" (запуск всех сервисов);

После запуска приложения витрины интернет-магазина одним из перечисленным выше способом в браузере перейти на страницу http://localhost:8080/products
